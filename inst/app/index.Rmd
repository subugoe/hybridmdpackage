---
title: "Metacheck input"
output: 
  flexdashboard::flex_dashboard:
    css: !expr subugoetheme::pkgdown_template()$assets$css
runtime: shiny
---

```{r global, include=FALSE}
library(shiny)
library(shinyvalidate)
```


Column
-----------------------------------------------------------------------

### Registration

```{r}
biblids::doiEntryUI(id = "dois")
textInput(
  inputId = "email",
  label  = "Email Address:",
  placeholder = "jane.doe@uni-foo.edu"
)
shiny::actionButton(
  label = "Email Compliance Report",
  inputId = "create"
)
```


```{r}
is_valid_email <- function(x) {
  grepl("^\\s*[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}\\s*$", as.character(x), ignore.case=TRUE)
}
iv <- InputValidator$new()
iv$add_rule("email", sv_required())
iv$add_rule("email", ~ if (!is_valid_email(.)) "Please provide a valid email")
iv$enable()
dois <- biblids::doiEntryServer(id = "dois")
observeEvent(input$create, {
  send_email(
    to = input$email,
    email = render_email(dois = dois())
  )
})
```
