---
title: "Metacheck input"
output: 
  flexdashboard::flex_dashboard:
    css: !expr subugoetheme::pkgdown_template()$assets$css
runtime: shiny
---

```{r global, include=FALSE}
library(shiny)
```


Inputs {.sidebar}
-----------------------------------------------------------------------

```{r}
shinyjs::useShinyjs(rmd = TRUE)
biblids::doiEntryUI(id = "dois")
shinyjs::disabled(
  actionButton(
    label = "Preview Compliance Report",
    inputId = "preview",
    width = "100%"
  )
)
emailReportUI(id = "send")
```

```{r}
# get dois
dois <- biblids::doiEntryServer(id = "dois")

# used to disambiguate excel file names
session_id <- as.character(floor(runif(1) * 1e20))
report <- reactive({
  withProgress(
      expr = {
        render_email(dois = dois(), session_id = session_id)
      },
      message = "Generating report..."
    )
  render_email(dois = dois(), session_id = session_id)
})

# preview
observe({
  shinyjs::toggleState("preview", shiny::req(dois()))
})
observeEvent(input$preview, {
  output$draft <- renderUI(report()$html_html)
})

# email
emailReportServer(id = "send", dois = dois, email = report())
```

Results
-----------------------------------------------------------------------

```{r}
shiny::uiOutput("draft")
```
